---
const posts = Astro.fetchContent('../pages/posts/*.md')

const sortedPosts = posts.sort((a, b) => {
  const dateA = new Date(a.date)
  const dateB = new Date(b.date)
  let order = dateB.getFullYear() - dateA.getFullYear()
  if (order === 0) {
    order = dateB.getMonth() - dateA.getMonth()
  }
  if (order === 0) {
    order = dateB.getDate() - dateA.getDate()
  }
  return order
})

sortedPosts.map((post) => console.log(post.title, post.date))

const getYear = (date) => {
  return new Date(date).getFullYear()
}
---

<div class="px-4">
  <div class="grid grid-cols-12 py-2 px-1 text-xs gap-2 font-bold">
    <div class="title">title</div>
    <div class="type">type</div>
    <div class="date">
      <div class="flex justify-end">date</div>
    </div>
  </div>
  <div class="border-b border-light-text">
    {sortedPosts.map(({ title, category, date, url }, index, posts) => {
      let newYear = false
      let year = 0
      if (index && getYear(posts[index - 1].date) !== getYear(date)) {
        newYear = true
        year = getYear(date)
      } else if (!index) {
        newYear = true
        year = getYear(posts[0].date)
      }
      date = new Date(date)
      return (
        <div>
          {newYear &&
            `<div class="border-t border-light-text bg-slate-100 text-right
              text-sm py-2 pr-1 cursor-default">${year}</div>`}
          <a class="hover-animation" href={url}>
            <div class="row">
              <div class="title break-all md:break-words">{title}</div>
              <div class="type break-all md:break-words">{category}</div>
              <div class="date break-all md:break-words">
                <div class="flex justify-end">{`${
                  date.getMonth() + 1
                }/${date.getDate()}`}</div>
              </div>
            </div>
          </a>
        </div>
      )
    })}
  </div>
</div>
